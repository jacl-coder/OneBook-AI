# OneBook AI — Functional Specification (MVP)

## 1. User Goals
- 上传一本书，让系统理解内容。
- 与书进行对话式问答，获取基于书本的回答并查看出处。
- 管理已上传的书（查看状态、删除）。

## 2. Core User Flows
### 2.1 上传与处理
1) 用户选择文件（PDF/EPUB/TXT）。  
2) 当前实现主要校验上传字段与可解析性，未设置全局大小上限。  
3) 进入后台处理（非持久队列），显示状态：排队 → 处理中 → 可对话或 失败。  
4) 失败时展示原因（当前无重试入口）；成功后书进入列表并可被选择对话。

### 2.2 选择书并对话
1) 用户在书库列表中选择一本文档状态为“可对话”的书。  
2) 打开对话界面，输入问题。  
3) 系统基于该书内容生成回答，并附带出处信息（如章节/页码/段落摘要，若可用）。  
4) 当前实现会保存消息，但未将历史消息纳入生成上下文。  
5) 用户可以切换书籍开始新会话，历史对话当前按书维度保存。

### 2.3 书库管理
- 查看：列出已上传书籍及状态（排队/处理中/可对话/失败）。
- 删除：用户可删除一本书及其衍生数据（索引等）；删除后该书相关对话不可再访问。

## 3. States & Status
- 书籍处理状态：`排队` → `处理中` → `可对话` | `失败`。
- 对话会话：与某本书绑定；消息会入库，后续可用于上下文。

## 4. Inputs & Validation
- 支持格式：PDF/EPUB/TXT；其他格式直接提示不支持。
- 大小/页数：当前未设置全局上限，建议后续补充限制策略。

## 5. Outputs
- 对话返回：答案文本 + 出处信息（章节/页码/段落摘要等，若可获取）。
- 状态反馈：处理进度/状态、失败原因（如格式不支持、文件过大、解析失败）。

## 6. Error Handling
- 上传校验不通过：提示原因并允许重新选择文件。
- 处理失败：保留失败记录，提示重试或删除。
- 未选择书籍时访问对话：提示先选择或上传一本书。

## 7. Security & Compliance (用户提示层面)
- 上传时提示需遵守版权和法律；用户对上传内容负责。
- 用户数据（书籍、对话）仅对上传者可见。

## 8. Acceptance Criteria (MVP)
- 能上传支持格式的书籍，处理流程可达“可对话”状态。
- 对话回答基于所选书籍内容，默认带出处提示。
- 关键路径可用：上传→处理→对话→删除；状态与错误提示清晰。
