# OneBook AI — Functional Specification (MVP)

## 1. 用户目标
- 上传一本书，让系统理解内容。
- 与书进行对话式问答，获取基于书本的回答并查看出处。
- 管理已上传的书（查看状态、删除、下载）。

## 2. 核心用户流程
### 2.1 上传与处理
1) 用户选择文件（PDF/EPUB/TXT）。
2) 系统校验扩展名白名单与大小上限（默认 50MB）。
3) 进入后台处理队列（Redis Streams）：`queued → processing → ready | failed`。
4) 失败时返回错误信息；队列会自动重试（可配置次数）。

### 2.2 选择书并对话
1) 用户在书库列表中选择状态为 `ready` 的书。  
2) 输入问题，系统基于该书内容生成回答。  
3) 返回回答与出处信息（章节/页码/段落来源）。  
4) 系统保存消息，并将最近 N 轮历史纳入上下文（可配置）。

### 2.3 书库管理
- 查看：列出已上传书籍及状态、大小与时间。
- 下载：返回预签名 URL，浏览器下载文件名为原始文件名。
- 删除：删除书籍与其关联的 chunks/消息。

## 3. 状态与可见性
- 书籍处理状态：`queued` → `processing` → `ready` | `failed`。
- 任务进度：当前仅提供状态与错误信息，不提供百分比进度。

## 4. 输入与校验
- 支持格式：PDF/EPUB/TXT；其他格式提示不支持。
- 大小限制：默认 50MB，可通过环境变量调整。

## 5. 输出
- 对话返回：答案文本 + 出处信息（来源位置与摘要）。
- 状态反馈：处理状态与失败原因。

## 6. 错误处理
- 上传校验不通过：明确提示原因并允许重新上传。
- 处理失败：记录失败状态与原因；支持删除或重新上传。
- 书籍未 ready：对话请求返回“未准备好”提示。

## 7. 安全与合规
- 上传需提示版权与合规责任归用户。
- 用户数据（书籍、对话）仅对该用户可见（管理员除外）。

## 8. MVP 验收标准
- 能上传支持格式的书籍并完成处理至 ready。
- 对话回答基于所选书籍内容且带出处。
- 关键路径可用：上传 → 处理 → 对话 → 下载/删除。
