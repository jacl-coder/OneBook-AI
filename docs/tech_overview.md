# OneBook AI — 技术框架（简版）

## 栈概要
- 后端：Go（标准库 `net/http` 为主）。
- 数据库：Postgres + pgvector（存储元数据与向量）。
- 前端：React（Vite + React SPA，后续可迁移 Next.js）。
- 存储：MinIO（S3 兼容对象存储）。
- 任务执行：服务内后台 goroutine 处理解析/索引（尚未接入持久队列）。
- 鉴权：JWT（HMAC-SHA256，含 TTL，登录/注册下发，登出通过撤销列表生效）；也支持 Redis 会话。

## 核心组件
- 上传与校验：接收 PDF/EPUB/TXT，写文件存储，触发后台处理。
- 解析与索引：文本抽取 → 清洗 → 语义分块（保留章节/页码元数据） → 嵌入 → 写入 pgvector。
- 对话服务：根据书 ID 检索相关 chunk，构造提示调用 LLM，返回回答与出处。
- 书库与状态：查询书列表、处理状态（排队/处理中/可对话/失败），删除书及衍生数据。
- 会话与历史：按书保存消息记录，后续可用于上下文。

## 外部/可替换接口
- LLM 接口：当前使用 Gemini 生成回答，可替换为本地模型或云 API（OpenAI/Claude 等）。
- Embedding 接口：支持本地 Ollama 或 Gemini。

## 非功能基线
- 处理时长：常规书（几十到数百页）在可接受时间内完成，并有状态提示。
- 对话延迟：目标在几秒级返回，默认附出处信息。
- 安全提示：上传需提示版权自担，数据仅对本人可见。 
